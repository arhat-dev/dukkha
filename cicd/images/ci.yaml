workflow:run:
# build container images
# required by ci job
- name: build-images
  jobs:
  - task:
      ref: buildah:xbuild(dukkha)
      matrix_filter: {}

# push built container images
# required by ci job
- name: push-images
  jobs:
  - task:
      ref: buildah:login(ghcr)
      matrix_filter: {}
  - task:
      ref: buildah:push(dukkha)
      matrix_filter: {}

# sign container images
# required by ci job
- name: sign-images
  jobs@tpl: |-
    {{- if and (eq env.GITHUB_ACTIONS "true") env.GIT_TAG -}}
    - task:
        ref: docker:login(ghcr)
        matrix_filter: {}
    - task:
        ref: cosign:sign-image(dukkha)
        matrix_filter: {}
    {{- else -}}
    - idle: "skip non release job"
    {{- end -}}
