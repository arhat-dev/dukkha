workflow:run:
# build container images
# required by ci job
- name: build-images
  jobs:
  - task:
      ref: buildah:xbuild(dukkha)
      matrix_filter: {}

# push built container images
# required by ci job
- name: push-images
  jobs:
  - task:
      ref: buildah:login(ghcr)
      matrix_filter: {}
  - task:
      ref: buildah:push(dukkha)
      matrix_filter: {}

# sign container images
# required by ci job
- name: sign-images
  jobs:
  - if@tmpl: &github |-
      {{- all (eq env.GITHUB_ACTIONS "true") git.tag -}}
    task:
      ref: docker:login(ghcr)
      matrix_filter: {}

  - if@tmpl: *github
    task:
      ref: cosign:sign-image(dukkha)
      matrix_filter: {}
