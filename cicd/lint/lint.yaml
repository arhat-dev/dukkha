workflow:run:
# merge yaml config using dukkha render
- name: prepare-linter-config
  matrix:
    include:
    - local:
      - cicd/lint/config/golangci-lint.yml
      preset:
      - tools/golangci-lint/config.vendor.yaml
      output:
      - &golangci_lint_config
        __@tlang: fs.Join dukkha.CacheDir "golangci-lint.yaml"
  jobs:
  - idle@tlang: mkdir "-p" dukkha.CacheDir
  - shell: |-
      tmpl:dukkha.Self render --chdir . <<EOF > "${MATRIX_OUTPUT}"
      __@!:
        value@presets: ${MATRIX_PRESET}
        merge:
        - value@file: ${MATRIX_LOCAL}
        map_list_append: true
      EOF

# required by ci job
- name: lint
  matrix:
    include:
    - tool: [editorconfig-checker]
      config:
      - __@presets#cached-file?str: tools/editorconfig-checker/config.json
    - tool: [shellcheck]
    - tool: [yamllint]
      config:
      - __@presets#cached-file?str: tools/yamllint/config.yaml
    - tool: [golangci-lint]
      config:
      - *golangci_lint_config
  hooks:
    before:
    - task:
        ref: workflow:run(prepare-linter-config)
        matrix_filter: {}

  jobs:
  - cmd@presets?str|tmpl#use-spec: tools/presets.tpl
