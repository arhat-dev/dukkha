workflow:run:
# required by ci job
- name: tidy
  jobs:
  - task:
      ref: workflow:run(tidy-go-mod)
      matrix_filter: {}
  - task:
      ref: workflow:run(docs)
      matrix_filter: {}

# ensure tidy go mod
- name: tidy-go-mod
  env:
  - name: GOPROXY
    value: direct
  - name: GOSUMDB
    value: "off"
  jobs:
  - shell: |-
      go mod tidy
      go mod vendor

# generate docs
- name: docs
  jobs:
  # TODO: schemer can panic when there is no build cache, fix it and remove while do
  - shell: |-
      while ! go test -v -mod=readonly -tags="docs" ./docs ; do
        :
      done

  - task:
      ref: golang:test(dukkha)
      matrix_filter:
        pkg:
        - pkg/templateutils
