workflow:run:
# required by ci job
- name: test
  jobs:
  - task: golang:test(dukkha, {})
  # test shell PATH lookup
  # if any issue, fix it in https://github.com/arhat-dev/sh/tree/dukkha
  - shell@file: cicd/test/fixtures/001-path-lookup-native.sh

  - if@tpl: &not_windows |-
      {{- ne host.kernel "windows" | toString -}}
    task: |-
      golang:build(dukkha, {
        kernel: [windows],
        arch: [x86, amd64]
      })
  - if@tpl: *not_windows
    shell@file: cicd/test/fixtures/002-path-lookup-in-wine64.sh

- name: report
  matrix:
    tool:
    - sonar-scanner
  jobs:
  # only run sonar scan on linux and darwin during CI
  - cmd@presets?str|tpl#use-spec: tools/presets.tpl
    continue_on_error: true
