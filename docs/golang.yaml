tools:
  go:
  - id: default
    env:
    - GO111MODULE=on
    - GO_PROXY=direct
    - GO_SUMDB=off
    # path: /path/to/your/go
    args: []
    # tool specific config
    config:
      # build options shared by all tasks
      global_build_options:
        # -x
        debug: false
        # -race
        race: false
        # -buildmode=<pie | exe | plugin | default | c-shared | c-archive | shared | archive>
        buildmode: pie
        # -compiler
        compiler: gc
        asmflags: []
        gccgoflags: []
        gcflags: []
        ldflags: []
        # build tags
        tags:
        - netgo
        # -mod=<vendor | readonly | mode>
        # defaults to `vendor` if there is a vendor directory
        # otherwise defaults to `readonly`
        mod: vendor
        trimpath: true
      run:
        dir: .build
      test:
        dir: .test
      coverage:
        dir: .coverage
      profile:
        dir: .profile
      build:
        dir: .build
      release:
        dir: .release

go:test:
- name: <name your test>
  race: true
  package: ./pkg/...

go:coverage:
- name: <same name of your test>
  fail_under: 10
  ignore_match:
  - ^TestFoo$

go:benchmark:
- name: <name your benchmark>
  race: true
  package: ./pkg/...

go:profile:
- name: <name your pprof>
  mem:
    enabled: false
    listen: localhost:8000
  cpu: {}
  mutex: {}
  block: {}
  trace: {}

go:build:
- name: <name your build>
  matrix:
    include:
    - kernel:
      - darwin
      arch:
      - amd64
      - arm64
    exclude:
    - kernel:
      - windows
      arch:
      - arm64
      - s390x
      - ppc64le
      - mips64le
    # built-in matrix kernel, defaults to [ $HOST_KERNEL ]
    kernel:
    - darwin
    - windows
    - linux
    # built-in matrix arch, defaults to [ $HOST_ARCH ]
    arch:
    - amd64
    - arm64
    - armv5
    - armv6
    - armv7
    - s390x
    - ppc64le
    - mips64le
  # go build -o
  output@template: |-
    .{{- .MATRIX_ARCH -}}
  src: ./cmd/dukkha

# release task to inherit, extend and override attributes from the build task
go:release:
- name: <same name of your build>
  extend:
    ldflags:
    - -s
    - -w
  override:
    cflags:
    - -I/include

run:
- name: <name>
