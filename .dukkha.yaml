include:
- cicd

renderers:
  http:
    enable_cache: true
    cache_max_age: 5h
  env:
    enable_exec: true

  http:presets:
    enable_cache: true
    cache_max_age: 2h
    base_url: https://raw.githubusercontent.com/arhat-dev/dukkha-presets/master/

global:
  default_git_branch: master
  env:
  - name: GO_VERSION
    value: "1.17"
  values:
    cmd:
      run_container@http:presets|template: templates/cmd-run-container.yml

tools:
  archive:
  - name: local
  - name: in-ctr

  workflow:
  - name: local
  - name: in-ctr

  golang:
  - name: local
  - name: in-ctr
    cmd@http:presets|template: golang/cmd-in-ctr.yml

  cosign:
  - name: local
  # TODO: support in container cosign
  - name: in-ctr

  # docker is required by cosign upload (login to docker registry)
  docker:
  - name: local
  # TODO: support docker in docker
  - name: in-ctr

  github:
  - name: local
  - name: in-ctr

  buildah:
  - name: local
  - name: in-ctr
    env:
    - name: RUN_CTR_PRIVILEGED
      value: "true"
    - name: RUN_CTR
      value@http:presets?str|template?str: templates/cmd-run-container.yml
    cmd@http:presets|template: buildah/cmd-in-ctr.yml
